# バーンズリーのシダ生成アプリ 要件定義書

## 📋 プロジェクト概要

### 基本情報
- **アプリ名**: バーンズリーのシダ（Barnsley Fern）生成アプリ
- **目的**: 確率的反復関数系（IFS）を使用してシダの葉のフラクタル図形をリアルタイムで生成・表示する教育的ビジュアライゼーションアプリ
- **ターゲットユーザー**: 
  - 数学やフラクタルに興味がある学生・教育者
  - プログラミング学習者
  - デジタルアート愛好家
- **使用技術**: HTML5, CSS3, JavaScript (Vanilla)
- **開発環境**: Claude Code

## 🎯 機能要件

### コア機能
- [x] **IFSアルゴリズム実装**
  - 4つのアフィン変換関数（茎、小葉、左葉、右葉）
  - 各変換の確率的選択（1%, 85%, 7%, 7%）
  - 点の反復計算と座標変換

- [x] **リアルタイム描画**
  - Canvas APIを使用した高速描画
  - 1フレームあたり複数点（100-1000点）の描画
  - 累積的な点群表示（最大100万点）

- [x] **インタラクティブコントロール**
  - 描画速度調整スライダー（10-5000点/フレーム）
  - カラーテーマ切り替え（5種類以上）
  - 描画の開始/停止/リセット機能
  - 点の総数表示カウンター

### UI/UX要件
- [x] **レスポンシブデザイン**
  - デスクトップ（1920x1080）最適化
  - タブレット（768px）対応
  - モバイル（375px）対応

- [x] **視覚的フィードバック**
  - 描画アニメーション（フェードイン効果）
  - ボタンホバーエフェクト
  - スムーズなトランジション（0.3秒）
  - プログレス表示

- [x] **ユーザーガイダンス**
  - 初回起動時の説明モーダル
  - ツールチップヘルプ
  - 操作説明テキスト

### 操作性要件
- [x] **直感的なコントロール**
  - ワンクリックで描画開始
  - スライダーによる速度調整
  - 明確なボタンラベル

- [x] **エラーハンドリング**
  - Canvas API非対応ブラウザの検出
  - メモリ不足時の自動調整
  - 適切なエラーメッセージ表示

## 🔧 非機能要件

### パフォーマンス
- [x] **描画性能**
  - 60FPS維持（低速設定時）
  - 30FPS以上（高速設定時）
  - メモリ使用量500MB以下

- [x] **最適化**
  - requestAnimationFrameの使用
  - 描画バッチ処理
  - メモリ効率的な点管理

### アクセシビリティ
- [x] **WCAG 2.1 AA準拠**
  - キーボード操作対応（Tab, Enter, Space）
  - ARIAラベルの適切な使用
  - フォーカス表示の明確化

- [x] **色覚多様性対応**
  - 色弱対応カラーパレット
  - 高コントラストオプション
  - 色以外の識別要素（形状、パターン）

### ユニバーサルデザイン
- [x] **認知負荷の軽減**
  - シンプルなインターフェース
  - 一貫した操作体系
  - 適切な情報階層

- [x] **多様なユーザー対応**
  - 文字サイズの可読性
  - タッチターゲット44px以上
  - 十分なクリック領域

## 🎨 デザイン仕様

### カラーパレット
```css
/* メインテーマ: 自然の緑 */
--fern-green: #228B22;
--fern-light: #90EE90;
--fern-dark: #006400;

/* 背景グラデーション */
--bg-dark: #0f2027;
--bg-mid: #203a43;
--bg-light: #2c5364;

/* UIカラー（色弱対応） */
--primary-blue: #1e40af;
--white: #ffffff;
--gray-dark: #374151;
```

### レイアウト
- **ヘッダー**: タイトル + 説明文
- **キャンバスエリア**: 中央配置、最大900x600px
- **コントロールパネル**: 下部配置、横並び
- **情報表示**: 右上コーナー

## 💻 技術仕様

### ファイル構成
```
barnsley-fern/
├── index.html          # メインHTML
├── style.css          # スタイルシート
├── script.js          # メインロジック
└── README.md          # プロジェクト説明
```

### アルゴリズム詳細
```javascript
// IFS変換関数の係数
const transforms = [
  { a: 0,     b: 0,     c: 0,    d: 0.16,  e: 0,    f: 0,     p: 0.01 }, // 茎
  { a: 0.85,  b: 0.04,  c: -0.04, d: 0.85,  e: 0,    f: 1.6,   p: 0.85 }, // 主葉
  { a: 0.2,   b: -0.26, c: 0.23,  d: 0.22,  e: 0,    f: 1.6,   p: 0.07 }, // 左葉
  { a: -0.15, b: 0.28,  c: 0.26,  d: 0.24,  e: 0,    f: 0.44,  p: 0.07 }  // 右葉
];
```

### Canvas設定
- **解像度**: devicePixelRatio対応
- **座標系**: 中心原点、Y軸上向き
- **スケール**: 自動調整（-3 to 3, 0 to 10）

## 📊 品質基準

### 完了条件
- [ ] 全機能の動作確認完了
- [ ] 3つ以上のブラウザでテスト
- [ ] Lighthouse スコア90点以上
- [ ] 色弱シミュレーターでの確認完了

### テストケース
1. **基本動作**
   - 描画開始・停止が正常に動作
   - リセットで初期状態に戻る
   - 速度調整が即座に反映

2. **パフォーマンス**
   - 100万点描画でもクラッシュしない
   - メモリリークが発生しない
   - CPUが100%に張り付かない

3. **レスポンシブ**
   - 画面回転で適切に再配置
   - タッチ操作が正常動作
   - 小画面でも操作可能

## 🚀 実装優先順位

### Phase 1: MVP（必須機能）
1. Canvas設定と基本描画
2. IFSアルゴリズム実装
3. 基本的な開始/停止機能

### Phase 2: 基本機能拡張
4. 速度調整スライダー
5. カラーテーマ（最低3種）
6. 点数カウンター

### Phase 3: UX向上
7. アニメーション効果
8. レスポンシブ対応
9. 初回ガイダンス

### Phase 4: アクセシビリティ
10. キーボード操作
11. 色弱対応モード
12. ARIA対応

## 📝 Claude Codeへの初回プロンプト例

```
新しいバーンズリーのシダ（Barnsley Fern）生成アプリを作成したいです。

基本機能:
- IFS（確率的反復関数系）でシダの葉を描画
- リアルタイムで点を追加していくアニメーション
- 描画速度の調整機能
- 複数のカラーテーマ

この要件定義書に従って、まずTodoListで実装計画を立ててから、Phase 1のMVPから順次実装してください。
各フェーズ完了時にはtodoを更新して進捗を管理してください。
```

## 🔄 追加改善プロンプト例

```
Phase 1が完了しました。次のPhase 2に進んでください:
- 速度調整スライダーの実装
- 3種類以上のカラーテーマ追加
- リアルタイム点数カウンター
完了したらtodoを更新してください。
```

---
*要件定義書バージョン: 1.0*
*作成日: 2025年1月*
*対象開発環境: Claude Code*